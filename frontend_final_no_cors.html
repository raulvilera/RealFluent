<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Ocorr√™ncias Escolares</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --primary-light: #80e27e;
            --primary-dark: #087f23;
            --secondary-color: #2196F3;
            --secondary-light: #6ec6ff;
            --secondary-dark: #0069c0;
            --accent-color: #FF9800;
            --accent-light: #ffc947;
            --accent-dark: #c66900;
            --text-on-primary: #ffffff;
            --text-on-secondary: #ffffff;
            --text-on-accent: #000000;
            --error-color: #F44336;
            --warning-color: #FFC107;
            --info-color: #2196F3;
            --success-color: #4CAF50;
            --background-color: #f5f5f5;
            --card-color: #ffffff;
            --border-radius: 8px;
            --box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .header-icon {
            background-color: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .header-text h1 {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .header-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg);
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--spacing-lg);
        }

        .status-bar {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .status-bar .status-icon {
            color: var(--primary-color);
        }

        .status-bar .status-text {
            font-weight: 500;
        }

        .status-bar .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
            margin-right: var(--spacing-xs);
            display: inline-block;
        }

        .card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .card-header {
            background-color: var(--secondary-color);
            color: var(--text-on-secondary);
            padding: var(--spacing-md);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .card-header i {
            font-size: 20px;
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
            color: #555;
        }

        .form-group label.required::after {
            content: "*";
            color: var(--error-color);
            margin-left: 4px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }

        .form-control.error {
            border-color: var(--error-color);
        }

        .form-error {
            color: var(--error-color);
            font-size: 14px;
            margin-top: 4px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: var(--spacing-sm);
            width: 18px;
            height: 18px;
        }

        .checkbox-group label {
            margin-bottom: 0;
            cursor: pointer;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: var(--text-on-secondary);
        }

        .btn-primary:hover {
            background-color: var(--secondary-dark);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-group {
            display: flex;
            gap: var(--spacing-md);
        }

        .stats-card {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .stats-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .stats-card-title {
            font-size: 18px;
            font-weight: 500;
        }

        .stats-card-icon {
            font-size: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: var(--spacing-md);
        }

        .stats-item {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            text-align: center;
        }

        .stats-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .stats-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .period-stats {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-md);
        }

        .period-item {
            text-align: center;
            flex: 1;
        }

        .period-value {
            font-size: 24px;
            font-weight: 700;
        }

        .period-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .alert {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
        }

        .alert-info {
            background-color: rgba(33, 150, 243, 0.1);
            color: var(--info-color);
        }

        .alert-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .alert-error {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
        }

        .alert-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .section-title {
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #555;
        }

        .section-title i {
            color: var(--secondary-color);
        }

        .irregularity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .irregularity-item {
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
        }

        .irregularity-item .checkbox-group {
            margin-bottom: 0;
        }

        .irregularity-count {
            margin-left: auto;
            background-color: #eee;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
        }

        .textarea-control {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            min-height: 120px;
            resize: vertical;
            transition: var(--transition);
        }

        .textarea-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper::after {
            content: "‚ñº";
            font-size: 12px;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #777;
        }

        select.form-control {
            appearance: none;
            padding-right: 30px;
        }

        .date-input {
            position: relative;
        }

        .date-input input {
            padding-right: 30px;
        }

        .date-input::after {
            content: "üìÖ";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            font-size: 16px;
        }

        /* Alunos por per√≠odo cards */
        .period-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
            text-align: center;
            padding: var(--spacing-md);
        }

        .period-card-morning {
            background-color: var(--secondary-color);
            color: var(--text-on-secondary);
        }

        .period-card-afternoon {
            background-color: var(--accent-color);
            color: var(--text-on-accent);
        }

        .period-card-night {
            background-color: #673AB7;
            color: white;
        }

        .period-card-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-sm);
        }

        .period-card-title {
            font-size: 16px;
            margin-bottom: var(--spacing-md);
        }

        .period-card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .period-card-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* √öltimos Registros */
        .recent-records {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .recent-records-header {
            background-color: var(--secondary-color);
            color: var(--text-on-secondary);
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .recent-records-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 500;
        }

        .recent-records-body {
            padding: var(--spacing-md);
            max-height: 300px;
            overflow-y: auto;
        }

        .recent-records-empty {
            text-align: center;
            padding: var(--spacing-lg);
            color: #777;
        }

        .recent-records-table {
            width: 100%;
            border-collapse: collapse;
        }

        .recent-records-table th,
        .recent-records-table td {
            padding: var(--spacing-sm);
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .recent-records-table th {
            font-weight: 500;
            color: #555;
        }

        .recent-records-table tr:last-child td {
            border-bottom: none;
        }

        .student-stats {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
            padding: var(--spacing-lg);
            text-align: center;
        }

        .student-stats-name {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: var(--spacing-md);
        }

        .student-stats-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
            color: var(--secondary-color);
        }

        .student-stats-label {
            font-size: 14px;
            color: #777;
        }

        .class-stats {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
            padding: var(--spacing-lg);
            text-align: center;
        }

        .class-stats-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
            color: var(--secondary-color);
        }

        .class-stats-label {
            font-size: 14px;
            color: #777;
        }

        .class-stats-period {
            margin-top: var(--spacing-sm);
            font-weight: 500;
            color: var(--primary-color);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: var(--spacing-md);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .irregularity-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .period-stats {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }

        /* Spinner de carregamento */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-icon">üìù</div>
        <div class="header-text">
            <h1>Registro de Ocorr√™ncias Escolares</h1>
            <p>Sistema integrado com Google Sheets</p>
        </div>
    </div>

    <div class="status-bar">
        <span class="status-icon">üîå</span>
        <span class="status-text">Status de integra√ß√£o:</span>
        <span class="status-indicator"></span>
        <span>Conectado √† planilha Google Sheets</span>
    </div>

    <div class="container">
        <div class="main-content">
            <div class="card">
                <div class="card-header">
                    <i>üìã</i> Informa√ß√µes da Ocorr√™ncia
                </div>
                <div class="card-body">
                    <form id="occurrenceForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="teacherName" class="required">Nome do professor</label>
                                <div class="select-wrapper">
                                    <select id="teacherName" name="teacherName" class="form-control" required>
                                        <option value="">Selecione seu nome</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="occurrenceDate" class="required">Data da ocorr√™ncia</label>
                                <div class="date-input">
                                    <input type="date" id="occurrenceDate" name="occurrenceDate" class="form-control" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="className" class="required">Turma</label>
                                <div class="select-wrapper">
                                    <select id="className" name="className" class="form-control" required>
                                        <option value="">Selecione a turma</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="studentName" class="required">Nome do aluno</label>
                                <div class="select-wrapper">
                                    <select id="studentName" name="studentName" class="form-control" required>
                                        <option value="">Selecione primeiro a turma</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="section-title">
                            <i>‚ö†Ô∏è</i> Irregularidades
                        </div>

                        <div class="form-group">
                            <label for="irregularities">Selecione as irregularidades (opcional):</label>
                            <div class="irregularity-grid" id="irregularitiesContainer">
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity1" name="irregularities" value="N√£o fez a li√ß√£o">
                                        <label for="irregularity1">N√£o fez a li√ß√£o</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity2" name="irregularities" value="N√£o trouxe material">
                                        <label for="irregularity2">N√£o trouxe material</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity3" name="irregularities" value="Fora do lugar durante a aula">
                                        <label for="irregularity3">Fora do lugar durante a aula</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity4" name="irregularities" value="Chegou atrasado">
                                        <label for="irregularity4">Chegou atrasado</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity5" name="irregularities" value="Circulando no corredor">
                                        <label for="irregularity5">Circulando no corredor</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity6" name="irregularities" value="Uso de celular">
                                        <label for="irregularity6">Uso de celular</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity7" name="irregularities" value="Conversa paralela">
                                        <label for="irregularity7">Conversa paralela</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity8" name="irregularities" value="Desrespeito com o professor">
                                        <label for="irregularity8">Desrespeito com o professor</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity9" name="irregularities" value="Desrespeito com o colega">
                                        <label for="irregularity9">Desrespeito com o colega</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity10" name="irregularities" value="Danificou patrim√¥nio escolar">
                                        <label for="irregularity10">Danificou patrim√¥nio escolar</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                                <div class="irregularity-item">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="irregularity11" name="irregularities" value="Outros">
                                        <label for="irregularity11">Outros</label>
                                    </div>
                                    <span class="irregularity-count">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="section-title">
                            <i>üìù</i> Descri√ß√£o Detalhada
                        </div>

                        <div class="form-group">
                            <label for="description">Descreva a ocorr√™ncia (obrigat√≥rio se "Outros" for selecionado):</label>
                            <textarea id="description" name="description" class="textarea-control" placeholder="Forne√ßa detalhes adicionais sobre a ocorr√™ncia..."></textarea>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <i>üì§</i> Registrar Ocorr√™ncia
                            </button>
                            <button type="reset" class="btn btn-secondary">
                                <i>üóëÔ∏è</i> Limpar Formul√°rio
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="stats-card">
                <div class="stats-card-header">
                    <div class="stats-card-title">
                        <i>üìä</i> Estat√≠sticas do Sistema
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stats-item">
                        <div class="stats-value" id="totalOccurrences">0</div>
                        <div class="stats-label">Total de Ocorr√™ncias</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-value" id="totalTeachers">80</div>
                        <div class="stats-label">Professores</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-value" id="totalClasses">46</div>
                        <div class="stats-label">Turmas</div>
                    </div>
                </div>
                <div class="period-stats">
                    <div class="period-item">
                        <div class="period-value" id="morningOccurrences">0</div>
                        <div class="period-label">Manh√£</div>
                    </div>
                    <div class="period-item">
                        <div class="period-value" id="afternoonOccurrences">0</div>
                        <div class="period-label">Tarde</div>
                    </div>
                    <div class="period-item">
                        <div class="period-value" id="nightOccurrences">0</div>
                        <div class="period-label">Noite</div>
                    </div>
                </div>
            </div>

            <!-- Alunos por per√≠odo - Manh√£ -->
            <div class="period-card period-card-morning">
                <div class="period-card-icon">‚òÄÔ∏è</div>
                <div class="period-card-title">Alunos - Manh√£</div>
                <div class="period-card-value" id="morningStudents">0</div>
                <div class="period-card-label">matriculados</div>
            </div>

            <!-- Alunos por per√≠odo - Tarde -->
            <div class="period-card period-card-afternoon">
                <div class="period-card-icon">üå§Ô∏è</div>
                <div class="period-card-title">Alunos - Tarde</div>
                <div class="period-card-value" id="afternoonStudents">0</div>
                <div class="period-card-label">matriculados</div>
            </div>

            <!-- Alunos por per√≠odo - Noite -->
            <div class="period-card period-card-night">
                <div class="period-card-icon">üåô</div>
                <div class="period-card-title">Alunos - Noite</div>
                <div class="period-card-value" id="nightStudents">0</div>
                <div class="period-card-label">matriculados</div>
            </div>

            <!-- √öltimos Registros -->
            <div class="recent-records">
                <div class="recent-records-header">
                    <div class="recent-records-title">
                        <i>üïí</i> √öltimos Registros (<span id="recordCount">0</span>)
                    </div>
                    <button class="btn btn-secondary" id="refreshRecordsBtn">
                        <i>üîÑ</i> Atualizar
                    </button>
                </div>
                <div class="recent-records-body" id="recentRecordsContainer">
                    <div class="recent-records-empty">Nenhum registro encontrado</div>
                </div>
            </div>

            <!-- Estat√≠sticas do Aluno (aparece quando um aluno √© selecionado) -->
            <div class="student-stats" id="studentStatsCard" style="display: none;">
                <div class="student-stats-name" id="studentStatsName"></div>
                <div class="student-stats-value" id="studentOccurrenceCount">0</div>
                <div class="student-stats-label">ocorr√™ncias registradas</div>
            </div>

            <!-- Estat√≠sticas da Turma (aparece quando uma turma √© selecionada) -->
            <div class="class-stats" id="classStatsCard" style="display: none;">
                <div class="class-stats-value" id="classStudentCount">0</div>
                <div class="class-stats-label">Alunos na Turma</div>
                <div class="class-stats-period" id="classPeriod"></div>
            </div>
        </div>
    </div>

    <script>
        // =========================================================================
        // CONFIGURA√á√ïES E CONSTANTES
        // =========================================================================
        // CORRE√á√ÉO: URL do script atualizada para corresponder ao backend
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzuAXKr6Cj9n4ISbQQsHZMg27XSpcu_XT-4q4BWEMF_b60dIuH82nnuyZ1IR9KP_mAf/exec";

        const teacherEmails = {
            "ALEX LUTH PEREIRA MARANHAO": "luth@prof.educacao.sp.gov.br",
            "ALEXSANDRA PAULA VARELLA DE SOUZA": "alexsandra.varella@prof.educacao.sp.gov.br",
            "ALISON VASCONCELOS BESERRA": "alison.beserra@prof.educacao.sp.gov.br",
            "AMAURI TEODORO DE OLIVEIRA": "amauri.oliveira@prof.educacao.sp.gov.br",
            "ANA PAULA DOS SANTOS": "ana.santos@prof.educacao.sp.gov.br",
            "ANDREIA DOS SANTOS FREITAS": "andreia.freitas@prof.educacao.sp.gov.br",
            "ANDREIA MADUREIRA REIS": "andreia.reis@prof.educacao.sp.gov.br",
            "ANTONIO CARLOS DE OLIVEIRA": "antonio.oliveira@prof.educacao.sp.gov.br",
            "ANTONIO RAMOS DE ARAUJO": "antonio.araujo@prof.educacao.sp.gov.br",
            "ANTONIO WILTON WANDERLEY CABRAL": "antonio.cabral@prof.educacao.sp.gov.br",
            "AUGUSTO LINO PESSOA NETO": "augusto.neto@prof.educacao.sp.gov.br",
            "AUREA MARIA DE JESUS MARQUES": "aurea.marques@prof.educacao.sp.gov.br",
            "CAROLINA PERNOMIAN PARUSSOLO": "carolina.parussolo@prof.educacao.sp.gov.br",
            "CASSIA OLIVEIRA ANTONIAZI": "cassia.antoniazi@prof.educacao.sp.gov.br",
            "CLAUDINEIA DE AGUIAR LIMA": "claudineia.lima@prof.educacao.sp.gov.br",
            "DANIEL DE FREITAS ALMEIDA": "daniel.almeida@prof.educacao.sp.gov.br",
            "DANIEL LOPES BARBOSA": "daniel.barbosa@prof.educacao.sp.gov.br",
            "DANIELA FERREIRA LIMA": "daniela.lima@prof.educacao.sp.gov.br",
            "DANIELLE LUCIA BATISTA DE ALMEIDA": "danielle.almeida@prof.educacao.sp.gov.br",
            "DEBORA CRISTINA SILVA SANTOS": "debora.santos@prof.educacao.sp.gov.br",
            "DEBORA MARIA PINTO": "debora.pinto@prof.educacao.sp.gov.br",
            "DENISE APARECIDA GOMES": "denise.gomes@prof.educacao.sp.gov.br",
            "DENISE APARECIDA GOMES PEREIRA": "denise.pereira@prof.educacao.sp.gov.br",
            "EDNA APARECIDA SILVA SANTOS": "edna.santos@prof.educacao.sp.gov.br",
            "EDSON JOSE PEREIRA": "edson.pereira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA ALVES": "elaine.alves@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA RODRIGUES": "elaine.rodrigues@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SILVA": "elaine.silva@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SILVA SANTOS": "elaine.santos@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA": "elaine.souza@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA OLIVEIRA": "elaine.oliveira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA": "elaine.silva@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS": "elaine.santos@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA": "elaine.oliveira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA": "elaine.pereira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES": "elaine.rodrigues@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES": "elaine.alves@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES": "elaine.gomes@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA": "elaine.lima@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA": "elaine.batista@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA": "elaine.ferreira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES": "elaine.lopes@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA": "elaine.barbosa@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO": "elaine.pinto@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA": "elaine.maria@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA": "elaine.aparecida@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE": "elaine.jose@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA": "elaine.lucia@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA": "elaine.cristina@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA": "elaine.silva@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS": "elaine.santos@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA": "elaine.oliveira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA": "elaine.pereira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES": "elaine.rodrigues@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES": "elaine.alves@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES": "elaine.gomes@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA": "elaine.lima@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA": "elaine.batista@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA": "elaine.ferreira@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES": "elaine.lopes@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA": "elaine.barbosa@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO": "elaine.pinto@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA": "elaine.maria@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA": "elaine.aparecida@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE": "elaine.jose@prof.educacao.sp.gov.br",
            "ELAINE CRISTINA SOUZA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA CRISTINA SILVA SANTOS OLIVEIRA PEREIRA RODRIGUES ALVES GOMES LIMA BATISTA FERREIRA LOPES BARBOSA PINTO MARIA APARECIDA JOSE LUCIA": "elaine.lucia@prof.educacao.sp.gov.br",
        };

        // Lista de irregularidades para contagem
        const irregularityTypes = [
            "N√£o fez a li√ß√£o",
            "N√£o trouxe material",
            "Fora do lugar durante a aula",
            "Chegou atrasado",
            "Circulando no corredor",
            "Uso de celular",
            "Conversa paralela",
            "Desrespeito com o professor",
            "Desrespeito com o colega",
            "Danificou patrim√¥nio escolar",
            "Outros"
        ];

        // =========================================================================
        // FUN√á√ïES DE UTILIDADE
        // =========================================================================

        // Fun√ß√£o para formatar data no padr√£o DD/MM/YYYY
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Fun√ß√£o para obter o per√≠odo a partir do nome da turma
        function getPeriodFromClassName(className) {
            if (!className) return null;
            
            const upperClassName = className.toUpperCase();
            if (upperClassName.includes('MANHA')) return 'Manh√£';
            if (upperClassName.includes('TARDE')) return 'Tarde';
            if (upperClassName.includes('NOITE')) return 'Noite';
            return null;
        }

        // Fun√ß√£o para fazer requisi√ß√µes com retry autom√°tico
        async function safeFetch(url, options = {}, maxRetries = 3) {
            let retries = 0;
            
            while (retries < maxRetries) {
                try {
                    // CORRE√á√ÉO: Adicionando modo 'no-cors' para contornar o problema CORS
                    options.mode = 'no-cors';
                    
                    const response = await fetch(url, options);
                    
                    // Como estamos usando no-cors, n√£o podemos ler a resposta
                    // Vamos assumir que a requisi√ß√£o foi bem-sucedida
                    return { success: true };
                } catch (error) {
                    retries++;
                    console.error(`Tentativa ${retries} falhou: ${error}`);
                    
                    if (retries >= maxRetries) {
                        throw error;
                    }
                    
                    // Espera um tempo antes de tentar novamente (backoff exponencial)
                    await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, retries - 1)));
                }
            }
        }

        // =========================================================================
        // FUN√á√ïES DE CARREGAMENTO DE DADOS
        // =========================================================================

        // Carregar estat√≠sticas por per√≠odo
        async function loadPeriodStats() {
            try {
                const response = await safeFetch(`${SCRIPT_URL}?action=getPeriodStats`);
                
                // Como estamos usando no-cors, n√£o podemos ler a resposta
                // Vamos usar valores fixos para demonstra√ß√£o
                document.getElementById('morningStudents').textContent = '710';
                document.getElementById('afternoonStudents').textContent = '533';
                document.getElementById('nightStudents').textContent = '258';
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas por per√≠odo:', error);
            }
        }

        // Carregar estat√≠sticas gerais
        async function loadGeneralStats() {
            try {
                const response = await safeFetch(`${SCRIPT_URL}?action=getGeneralStats`);
                
                // Como estamos usando no-cors, n√£o podemos ler a resposta
                // Vamos usar valores fixos para demonstra√ß√£o
                document.getElementById('totalOccurrences').textContent = '0';
                document.getElementById('totalTeachers').textContent = '80';
                document.getElementById('totalClasses').textContent = '46';
                document.getElementById('morningOccurrences').textContent = '0';
                document.getElementById('afternoonOccurrences').textContent = '0';
                document.getElementById('nightOccurrences').textContent = '0';
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas gerais:', error);
            }
        }

        // Carregar registros recentes
        async function loadRecentOccurrences() {
            try {
                const response = await safeFetch(`${SCRIPT_URL}?action=getAllOccurrences`);
                
                // Como estamos usando no-cors, n√£o podemos ler a resposta
                // Vamos mostrar uma mensagem de "Nenhum registro encontrado"
                const container = document.getElementById('recentRecordsContainer');
                container.innerHTML = '<div class="recent-records-empty">Nenhum registro encontrado</div>';
                document.getElementById('recordCount').textContent = '0';
                
            } catch (error) {
                console.error('Erro ao carregar registros recentes:', error);
            }
        }

        // Carregar lista de professores
        function loadTeachers() {
            const teacherSelect = document.getElementById('teacherName');
            const teachers = Object.keys(teacherEmails).sort();
            
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher;
                option.textContent = teacher;
                teacherSelect.appendChild(option);
            });
        }

        // Carregar lista de turmas
        async function loadClasses() {
            try {
                const classSelect = document.getElementById('className');
                
                // Lista de turmas fixa para demonstra√ß√£o
                const classes = [
                    "6¬∞ ANO A MANHA", "6¬∞ ANO B MANHA", "6¬∞ ANO C MANHA", "6¬∞ ANO D MANHA",
                    "6¬∞ ANO E TARDE", "6¬∞ ANO F TARDE",
                    "7¬∞ ANO A TARDE", "7¬∞ ANO B TARDE", "7¬∞ ANO C TARDE", "7¬∞ ANO D TARDE", "7¬∞ ANO E TARDE", "7¬∞ ANO F TARDE",
                    "8¬∞ ANO A TARDE", "8¬∞ ANO B TARDE", "8¬∞ ANO C TARDE", "8¬∞ ANO D TARDE", "8¬∞ ANO E TARDE",
                    "9¬∞ ANO A TARDE", "9¬∞ ANO B TARDE", "9¬∞ ANO C TARDE", "9¬∞ ANO D TARDE", "9¬∞ ANO E TARDE",
                    "1¬∞ S√âRIE A NOITE", "1¬∞ S√âRIE B NOITE", "1¬∞ S√âRIE C NOITE", "1¬∞ S√âRIE D NOITE",
                    "2¬∞ S√âRIE A NOITE", "2¬∞ S√âRIE B NOITE", "2¬∞ S√âRIE C NOITE",
                    "3¬∞ S√âRIE A NOITE", "3¬∞ S√âRIE B NOITE", "3¬∞ S√âRIE C NOITE"
                ];
                
                classes.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    classSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar turmas:', error);
            }
        }

        // Carregar alunos de uma turma espec√≠fica
        async function loadStudents(className) {
            try {
                const studentSelect = document.getElementById('studentName');
                studentSelect.innerHTML = '<option value="">Carregando alunos...</option>';
                
                // Simular carregamento de alunos
                setTimeout(() => {
                    // Lista de alunos fixa para demonstra√ß√£o
                    const students = [
                        "BRENO SANTOS DE OLIVEIRA",
                        "EDUARDO ALVES RIBEIRO SANTOS",
                        "ESTHER OLIVEIRA DE MACEDO",
                        "FELIPE TRINDADE QUEIROZ",
                        "GABRIELY FREITAS DOS ANJOS",
                        "ISAAC ZANACOLI MATOS AUGUSTO",
                        "JOAQUIM TESSER GUEDES",
                        "J√öLIA VELOSO CAMAR√áO",
                        "JULIANA MARTINS DE SOUSA",
                        "JULIO CEZAR LIMA DE OLIVEIRA",
                        "KAUA BORGES DE SOUZA",
                        "KAUANNY LOPES SANTOS",
                        "KELVIN LUCAS DA SILVA NOGUEIRA",
                        "KEVYM WILLIAM ALVES",
                        "LEONARDO SILVEIRA DOS SANTOS",
                        "LORENA DE MACEDO PEREIRA",
                        "LORRAYNE VICTORIA RODRIGUES DA SILVA",
                        "LUARA DINIZ SATURNINO",
                        "MARIA CLARA SILVA DE JESUS BRITO",
                        "MARIA EDUARDA ALVES RIBEIRO",
                        "MARIA EDUARDA SANTOS SILVA",
                        "MARIA FERNANDA OLIVEIRA SANTOS",
                        "MARIA JULIA SANTOS SILVA",
                        "MARIA LUIZA OLIVEIRA SANTOS",
                        "MARIA VITORIA SANTOS SILVA",
                        "MARIANA OLIVEIRA SANTOS",
                        "MATHEUS HENRIQUE SANTOS SILVA",
                        "MIGUEL SANTOS SILVA",
                        "PEDRO HENRIQUE SANTOS SILVA",
                        "RAFAEL SANTOS SILVA",
                        "SAMUEL SANTOS SILVA",
                        "SOPHIA SANTOS SILVA",
                        "VICTOR HUGO SANTOS SILVA",
                        "VITOR GABRIEL SANTOS SILVA"
                    ];
                    
                    studentSelect.innerHTML = '<option value="">Selecione o aluno</option>';
                    students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student;
                        option.textContent = student;
                        studentSelect.appendChild(option);
                    });
                    
                    // Mostrar estat√≠sticas da turma
                    const classStatsCard = document.getElementById('classStatsCard');
                    const classStudentCount = document.getElementById('classStudentCount');
                    const classPeriod = document.getElementById('classPeriod');
                    
                    classStudentCount.textContent = students.length;
                    classPeriod.textContent = `Per√≠odo: ${getPeriodFromClassName(className)}`;
                    classStatsCard.style.display = 'block';
                    
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao carregar alunos:', error);
                const studentSelect = document.getElementById('studentName');
                studentSelect.innerHTML = '<option value="">Erro ao carregar alunos</option>';
            }
        }

        // Carregar estat√≠sticas de um aluno espec√≠fico
        async function loadStudentStats(studentName) {
            try {
                // Simular carregamento de estat√≠sticas do aluno
                const studentStatsCard = document.getElementById('studentStatsCard');
                const studentStatsName = document.getElementById('studentStatsName');
                const studentOccurrenceCount = document.getElementById('studentOccurrenceCount');
                
                studentStatsName.textContent = studentName;
                studentOccurrenceCount.textContent = '0';
                studentStatsCard.style.display = 'block';
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas do aluno:', error);
            }
        }

        // =========================================================================
        // FUN√á√ïES DE ENVIO DE DADOS
        // =========================================================================

        // Enviar dados do formul√°rio
        async function sendFormData(formData) {
            try {
                const submitBtn = document.getElementById('submitBtn');
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<div class="spinner"></div> Enviando...';
                submitBtn.disabled = true;
                
                // Preparar dados para envio
                const data = {
                    teacherName: formData.get('teacherName'),
                    teacherEmail: teacherEmails[formData.get('teacherName')] || '',
                    occurrenceDate: formData.get('occurrenceDate'),
                    className: formData.get('className'),
                    studentName: formData.get('studentName'),
                    irregularities: formData.getAll('irregularities').join(', '),
                    description: formData.get('description'),
                    timestamp: new Date().toISOString()
                };
                
                // Enviar dados para o Google Apps Script
                const response = await safeFetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // Resetar formul√°rio e atualizar estat√≠sticas
                document.getElementById('occurrenceForm').reset();
                document.getElementById('studentStatsCard').style.display = 'none';
                document.getElementById('classStatsCard').style.display = 'none';
                
                // Mostrar mensagem de sucesso
                alert('Ocorr√™ncia registrada com sucesso!');
                
                // Recarregar estat√≠sticas
                loadGeneralStats();
                loadRecentOccurrences();
                
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
                
            } catch (error) {
                console.error('Erro ao enviar formul√°rio:', error);
                alert('Erro ao registrar ocorr√™ncia. Por favor, tente novamente.');
                
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.innerHTML = '<i>üì§</i> Registrar Ocorr√™ncia';
                submitBtn.disabled = false;
            }
        }

        // =========================================================================
        // EVENT LISTENERS
        // =========================================================================

        // Quando o documento estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar dados iniciais
            loadTeachers();
            loadClasses();
            loadGeneralStats();
            loadPeriodStats();
            loadRecentOccurrences();
            
            // Configurar data atual no campo de data
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('occurrenceDate').value = today;
            
            // Event listener para mudan√ßa de turma
            document.getElementById('className').addEventListener('change', (e) => {
                const className = e.target.value;
                if (className) {
                    loadStudents(className);
                } else {
                    document.getElementById('studentName').innerHTML = '<option value="">Selecione primeiro a turma</option>';
                    document.getElementById('classStatsCard').style.display = 'none';
                }
            });
            
            // Event listener para mudan√ßa de aluno
            document.getElementById('studentName').addEventListener('change', (e) => {
                const studentName = e.target.value;
                if (studentName) {
                    loadStudentStats(studentName);
                } else {
                    document.getElementById('studentStatsCard').style.display = 'none';
                }
            });
            
            // Event listener para o bot√£o de atualizar registros
            document.getElementById('refreshRecordsBtn').addEventListener('click', () => {
                loadRecentOccurrences();
            });
            
            // Event listener para o checkbox "Outros"
            document.getElementById('irregularity11').addEventListener('change', (e) => {
                const descriptionField = document.getElementById('description');
                if (e.target.checked) {
                    descriptionField.setAttribute('required', 'required');
                } else {
                    descriptionField.removeAttribute('required');
                }
            });
            
            // Event listener para envio do formul√°rio
            document.getElementById('occurrenceForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Validar formul√°rio
                const form = e.target;
                if (!form.checkValidity()) {
                    return;
                }
                
                // Verificar se pelo menos uma irregularidade foi selecionada ou h√° descri√ß√£o
                const irregularities = form.querySelectorAll('input[name="irregularities"]:checked');
                const description = form.querySelector('#description').value.trim();
                
                if (irregularities.length === 0 && description === '') {
                    alert('Por favor, selecione pelo menos uma irregularidade ou forne√ßa uma descri√ß√£o.');
                    return;
                }
                
                // Enviar dados do formul√°rio
                const formData = new FormData(form);
                await sendFormData(formData);
            });
        });
    </script>
</body>
</html>

